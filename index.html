<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kotoha AI - æ„›åª›çœŒæ»åœ¨ã‚µãƒãƒ¼ãƒˆ</title>
  <meta name="theme-color" content="#1976d2" />
  <meta name="description" content="æ„›åª›çœŒã§ã®æ»åœ¨ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ" />
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="icons/icon-192x192.png" />

  <style>
    :root{
      --primary:#1976d2; --primary-2:#1e88e5; --accent:#ff7043;
      --bg:#f7f9fc; --text:#1f2937; --muted:#6b7280; --border:#e5e7eb; --surface:#ffffff;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans JP",sans-serif;color:var(--text);background:var(--bg);line-height:1.6}
    .wrap{max-width:1100px;margin:0 auto;padding:16px}

    /* -------- Header -------- */
    header.header{
      background:linear-gradient(180deg,var(--primary-2) 0%,var(--primary) 100%);
      color:#fff;border-radius:16px;padding:16px 16px 12px;position:sticky;top:0;z-index:10;
    }
    .header-row{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .title{margin:0;font-size:28px;letter-spacing:.3px}
    .beta{margin-left:8px;background:rgba(255,255,255,.2);padding:2px 8px;border-radius:999px}
    .subtitle{margin:6px 0 0;opacity:.95}
    .btn{border:1px solid rgba(255,255,255,.4);background:rgba(255,255,255,.15);color:#fff;padding:8px 12px;border-radius:8px;cursor:pointer}
    .btn.active{background:#fff;color:var(--primary)}
    .lang{display:flex;gap:8px}
    /* å³ä¸Šå›ºå®šã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ï¼ˆãƒ­ã‚°ã‚¤ãƒ³æ™‚ã®ã¿JSã§ display:flexï¼‰ */
    #user-info{position:fixed;top:12px;right:12px;display:none;gap:8px;align-items:center;z-index:10000}
    #logout-btn{position:relative;z-index:10001;pointer-events:auto;border:1px solid rgba(255,255,255,.4);background:rgba(255,255,255,.15);color:#fff;padding:8px 12px;border-radius:8px;cursor:pointer}

    /* -------- Progress -------- */
    .progress{margin-top:12px;background:#fff;border:1px solid var(--border);border-radius:12px;padding:12px}
    .bar{height:6px;background:var(--border);border-radius:999px;overflow:hidden}
    .fill{height:100%;width:25%;background:linear-gradient(90deg,var(--primary),var(--accent));border-radius:inherit;transition:width .25s}
    .steps{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-top:8px;font-size:14px;color:var(--muted)}
    .steps .on{color:var(--text);font-weight:600}

    /* -------- Sections / Cards -------- */
    .section{display:none}.section.active{display:block}
    .card{background:#fff;border:1px solid var(--border);border-radius:16px;padding:16px}
    .narrow{max-width:520px;margin:0 auto} /* ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ã®å¹…ã‚’åˆ¶å¾¡ */

    /* ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒ»ç›¸è«‡ãªã©ã®UI */
    .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    input,select,textarea{width:100%;padding:10px 12px;border:1px solid var(--border);border-radius:10px}
    .chipset{display:flex;gap:8px;flex-wrap:wrap}
    .chip{border:1px solid var(--border);background:#fff;border-radius:999px;padding:8px 12px;cursor:pointer}
    .chat{margin-top:12px;background:#fff;border:1px solid var(--border);border-radius:12px;padding:12px}
    .msgs{display:grid;gap:10px;max-height:55vh;overflow:auto}
    .msg{display:flex;gap:10px}
    .avatar{width:32px;height:32px;border-radius:999px;background:#eef2ff;display:flex;align-items:center;justify-content:center}
    .bubble{background:#f8fafc;border:1px solid var(--border);padding:10px 12px;border-radius:12px}
    .ai .bubble{background:#f1f8ff}
    .row{display:flex;gap:8px;margin-top:10px}
    .row input[type="text"]{flex:1}
    .primary{background:var(--primary);color:#fff;border-color:var(--primary)}
    .ghost{background:transparent;border:1px solid var(--border)}
    .footer{text-align:center;color:var(--muted);margin:24px 0}
  </style>

  <!-- Markdownæ•´å½¢ï¼ˆapp.js å†…ã® marked.parse ç”¨ï¼‰ -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
  <div class="wrap">
    <header class="header">
      <div class="header-row">
        <div>
          <h1 class="title">Kotoha AI <span class="beta">Î²</span></h1>
          <p class="subtitle">æ„›åª›çœŒã§ã®æ»åœ¨ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ</p>
        </div>
        <div class="lang">
          <button id="lang-ja" class="btn active">æ—¥æœ¬èª</button>
          <button id="lang-en" class="btn">English</button>
        </div>
      </div>
    </header>

    <!-- å³ä¸Šå›ºå®šã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ï¼ˆãƒ­ã‚°ã‚¤ãƒ³å¾Œã«JSã§ display:flex ã¸ï¼‰ -->
    <div id="user-info">
      <span id="user-display-name">ãƒ¦ãƒ¼ã‚¶ãƒ¼</span>
      <button id="logout-btn">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
    </div>

    <div class="progress">
      <div class="bar"><div class="fill" id="progress-fill"></div></div>
      <div class="steps">
        <div class="on" data-step="1">èªè¨¼</div>
        <div data-step="2">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</div>
        <div data-step="3">ç›¸è«‡</div>
        <div data-step="4">å±¥æ­´</div>
      </div>
    </div>

    <main>
      <!-- èªè¨¼ -->
      <section id="section-1" class="section active">
        <div class="card narrow">
          <h2>ã‚ˆã†ã“ã Kotoha AI ã¸</h2>
          <p>æ„›åª›çœŒã§ã®æ»åœ¨ã‚’ã‚ˆã‚Šå¿«é©ã«ã™ã‚‹ãŸã‚ã€ã¾ãšã¯ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã—ã‚‡ã†</p>

          <form id="login-form" style="display:grid;gap:12px">
            <h3>ãƒ­ã‚°ã‚¤ãƒ³ / Sign In</h3>
            <label>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹<input type="email" id="login-email" autocomplete="email" placeholder="you@example.com"></label>
            <label>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰<input type="password" id="login-password" autocomplete="current-password" placeholder="8æ–‡å­—ä»¥ä¸Š"></label>
            <div style="display:flex;gap:8px;flex-wrap:wrap">
              <button type="button" id="login-btn" class="btn primary">ãƒ­ã‚°ã‚¤ãƒ³</button>
              <button type="button" id="show-signup-btn" class="btn ghost">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆã¸</button>
              <button type="button" id="google-login-btn" class="btn ghost">Googleã§ãƒ­ã‚°ã‚¤ãƒ³</button>
              <button type="button" id="guest-login-btn" class="btn ghost">ã‚²ã‚¹ãƒˆã¨ã—ã¦åˆ©ç”¨</button>
            </div>
          </form>

          <form id="signup-form" style="display:none;grid:auto/1fr;gap:12px">
            <h3>ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ / Create Account</h3>
            <label>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹<input type="email" id="signup-email"></label>
            <label>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰<input type="password" id="signup-password"></label>
            <label>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç¢ºèª<input type="password" id="signup-password-confirm"></label>
            <div style="display:flex;gap:8px;flex-wrap:wrap">
              <button type="button" id="signup-btn" class="btn primary">ä½œæˆ</button>
              <button type="button" id="show-login-btn" class="btn ghost">ãƒ­ã‚°ã‚¤ãƒ³ã«æˆ»ã‚‹</button>
            </div>
          </form>
        </div>
      </section>

      <!-- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ« -->
      <section id="section-2" class="section">
        <div class="card">
          <h2>ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ« / Profile</h2>
          <p>æ»åœ¨åœ°ãƒ»ç›®çš„ãªã©ã‚’ç™»éŒ²ã™ã‚‹ã¨ã€ã‚ˆã‚Šé©åˆ‡ãªæ¡ˆå†…ãŒã§ãã¾ã™</p>

          <div style="display:grid;gap:12px;max-width:720px">
            <label>è¡¨ç¤ºå<input id="display-name" type="text" placeholder="ä¾‹ï¼šãƒ†ãƒƒã‚¯ã•ã‚“"></label>
            <label>å›½ç±<input id="nationality" type="text" placeholder="ä¾‹ï¼šJapan"></label>
            <label>æ»åœ¨åœ°ï¼ˆä¾‹ï¼šæ¾å±±å¸‚ï¼‰<input id="stay-location" type="text" placeholder="ä¾‹ï¼šæ¾å±±å¸‚"></label>
            <label>æ»åœ¨ç›®çš„<input id="stay-purpose" type="text" placeholder="ä¾‹ï¼šä»•äº‹"></label>

            <div class="grid-2">
              <label>æ»åœ¨é–‹å§‹<input id="stay-from" type="date"></label>
              <label>æ»åœ¨çµ‚äº†<input id="stay-to" type="date"></label>
            </div>

            <div>
              <div>ä½¿ç”¨è¨€èª</div>
              <div class="chipset">
                <label><input type="checkbox" value="ja">æ—¥æœ¬èª</label>
                <label><input type="checkbox" value="en">English</label>
                <label><input type="checkbox" value="zh">ä¸­æ–‡</label>
                <label><input type="checkbox" value="ko">í•œêµ­ì–´</label>
              </div>
            </div>

            <div style="display:flex;gap:8px">
              <button id="save-profile-btn" class="btn primary">ä¿å­˜</button>
              <button id="back-to-consultation-btn" class="btn ghost">ç›¸è«‡ã¸æˆ»ã‚‹</button>
            </div>
          </div>
        </div>
      </section>

      <!-- ç›¸è«‡ -->
      <section id="section-3" class="section">
        <div class="card">
          <h2>ç›¸è«‡ / Consultation</h2>
          <p>æ„›åª›çœŒå†…ã®æƒ…å ±ã«çµã£ã¦ã”æ¡ˆå†…ã—ã¾ã™</p>

          <div class="card" style="padding:12px;margin-bottom:12px">
            <h4>ğŸ’¡ ã‚ˆãã‚ã‚‹è³ªå•</h4>
            <div class="chipset">
              <button class="chip" data-question="ãƒã‚¹ã®ä¹—ã‚Šæ–¹ãŒã‚ã‹ã‚Šã¾ã›ã‚“ã€‚ã©ã†ã™ã‚Œã°ã„ã„ã§ã™ã‹ï¼Ÿ">ãƒã‚¹ã®ä¹—ã‚Šæ–¹ã¯ï¼Ÿ</button>
              <button class="chip" data-question="ç—…é™¢ã«è¡ŒããŸã„ã®ã§ã™ãŒã€äºˆç´„ã¯å¿…è¦ã§ã™ã‹ï¼Ÿ">ç—…é™¢ã®äºˆç´„æ–¹æ³•ã¯ï¼Ÿ</button>
              <button class="chip" data-question="Wi-FiãŒä½¿ãˆã‚‹å ´æ‰€ã‚’æ•™ãˆã¦ãã ã•ã„ã€‚">Wi-Fiåˆ©ç”¨å ´æ‰€ã¯ï¼Ÿ</button>
              <button class="chip" data-question="æ—¥æœ¬ã®ãƒãƒŠãƒ¼ã§æ³¨æ„ã™ã¹ãã“ã¨ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ">æ—¥æœ¬ã®ãƒãƒŠãƒ¼ã¯ï¼Ÿ</button>
              <button class="chip" data-question="ç·Šæ€¥æ™‚ã¯ã©ã“ã«é€£çµ¡ã™ã‚Œã°ã„ã„ã§ã™ã‹ï¼Ÿ">ç·Šæ€¥æ™‚ã®é€£çµ¡å…ˆã¯ï¼Ÿ</button>
            </div>
          </div>

          <div class="chat">
            <div id="chat-messages" class="msgs">
              <div class="msg ai">
                <div class="avatar">ğŸ¤–</div>
                <div class="bubble">
                  ã“ã‚“ã«ã¡ã¯ï¼Kotoha AIã§ã™ã€‚æ„›åª›çœŒã§ã®æ»åœ¨ã«é–¢ã™ã‚‹ã”è³ªå•ã«ã€ãªã‚“ã§ã‚‚ãŠç­”ãˆã—ã¾ã™ã€‚<br>
                  ã‚µãƒ³ãƒ—ãƒ«ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã‹ã€ç›´æ¥ã”è³ªå•ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚<br><br>
                  Hello! I'm Kotoha AI. Ask me anything about your stay in Ehime Prefecture.
                </div>
              </div>
            </div>
            <div class="row">
              <input id="chat-input" type="text" placeholder="ä¾‹ï¼šç—…é™¢ã®äºˆç´„æ–¹æ³•ã¯ï¼Ÿ" />
              <button id="send-button" class="btn primary">é€ä¿¡</button>
              <button id="clear-chat-btn" class="btn ghost">ã‚¯ãƒªã‚¢</button>
            </div>
          </div>
        </div>
      </section>

      <!-- å±¥æ­´ -->
      <section id="section-4" class="section">
        <div class="card">
          <h2>å±¥æ­´ / History</h2>
          <p>è¿‘æ—¥å…¬é–‹äºˆå®š</p>
        </div>
      </section>
    </main>

    <footer class="footer">
      <p>&copy; 2025 Kotoha AI - æ„›åª›æ–°èç¤¾ Ã— ã„ã‚ã¯TEC</p>
    </footer>
  </div>

  <!-- app.js ã¯ ES Modules ã§èª­ã¿è¾¼ã‚€ï¼ˆFirebase v10ã® import ã«å¿…é ˆï¼‰ -->
  <script type="module" src="./app.js"></script>
  <!-- Markdownæ•´å½¢ï¼ˆapp.js å†…ã§ marked.parse ç”¨ï¼‰ -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</body>
</html>
